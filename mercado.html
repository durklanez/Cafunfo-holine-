<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mercado - Cafunfo</title>

<style>
body {
  font-family: Arial;
  background: #f2f2f2;
  padding: 15px;
  margin: 0;
}

.card {
  background: #fff;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

img {
  width: 100%;
  height: auto;
  border-radius: 8px;
}

h3 {
  margin: 10px 0 5px 0;
}

p {
  margin: 5px 0;
}

strong {
  color: green;
  font-size: 18px;
}

button {
  padding: 10px;
  width: 100%;
  background: #22c55e;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

button:hover {
  background: #16a34a;
}
</style>
</head>
<body>

<h2>üõí Mercado Cafunfo</h2>
<div id="listaProdutos"></div>

<script>
// Fun√ß√£o para carregar produtos
function carregarProdutos(){
  let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
  let container = document.getElementById("listaProdutos");
  container.innerHTML = "";

  if(produtos.length === 0){
    container.innerHTML = "<p>Nenhum produto publicado ainda.</p>";
    return;
  }

  produtos.forEach((produto, index) => {
    let card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <img src="${produto.foto || 'https://via.placeholder.com/300x200'}" alt="${produto.nome}">
      <h3>${produto.nome}</h3>
      <p>${produto.descricao || ''}</p>
      <strong>${produto.preco ? produto.preco + " AKZ" : "Pre√ßo n√£o definido"}</strong>
      <button onclick="comprar(${index})">Comprar</button>
    `;

    container.appendChild(card);
  });
}

// Fun√ß√£o comprar (usar a que te enviei antes)
function comprar(index){
  let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
  let ordens = JSON.parse(localStorage.getItem("ordens")) || [];

  let produto = produtos[index];
  if(!produto){
    alert("Produto n√£o encontrado.");
    return;
  }

  let idOrdem = Date.now();
  let novaOrdem = {
    id: idOrdem,
    nome: produto.nome,
    preco: produto.preco,
    descricao: produto.descricao || "",
    foto: produto.foto || "",
    data: new Date().toLocaleString(),
    status: "Ordem enviada",
    vendedorLat: produto.lat || (-8.83 + Math.random()*0.02),
    vendedorLon: produto.lon || (13.23 + Math.random()*0.02)
  };

  localStorage.setItem("ordemAtual", JSON.stringify(novaOrdem));
  ordens.push(novaOrdem);
  localStorage.setItem("ordens", JSON.stringify(ordens));

  alert("‚úÖ Ordem enviada com sucesso!");
  window.location.href = "ordem.html";
}

// Carrega produtos assim que abre a p√°gina
carregarProdutos();
</script>

</body>
</html>
